<!DOCTYPE html>
<html>
<head>
	<meta charse="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<link rel="import" href="../mk-i18n-config.html">
</head>
<body>
	<mk-i18n-config id="element"></mk-i18n-config>
	<script>
    var browserLanguage = navigator.language || navigator.userLanguage;
		var element = document.getElementById("element");

		suite('mk-i18n-config', function(){
			
			test('when not specified, default language is browser language', function(){
				assert.equal(element.language, browserLanguage);
			});

			test('when not specified, default language is reflected to i18n', function(){
				assert.equal(element.language, i18n.lng());
				assert.equal(i18n.lng(), 'en-US');
			});

			test('when specified, element language is reflected to i18n', function(done){
				
				var semaphore = {
					refresh: function() {
							done();
					}
				};
        
        // add semaphore as observer
        mki18n.addObserver(semaphore);
				
				// wait until everything is done
				flush(function(){
					

	        // change language
					element.language = 'es';
				});

				// call the assert
				assert.equal(i18n.lng(), 'es');

			});

			// test('when specified but not available, i18n should fall back to default', function(done){
			// 	flush(function(){
			// 		element.language = 'bh';
			// 		done();
			// 	});
					
			// 	assert.equal(i18n.lng(), 'en');
			// });

			// test.only('when specified but not available, element language should also fall back', function(done){
			// 	flush(function() {
			// 		element.language = 'bh';
			// 		done(); // language remains default en-US (browser) before being compared to 'en'
			// 	});
			// 	assert.equal(element.language, 'en');
			// });
		});
</script>
</body>
</html>